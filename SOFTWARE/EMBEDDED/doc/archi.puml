@startuml FW_Architecture_GringGo

' Configuration du style
skinparam component {
  BorderColor #7B0099
  BackgroundColor #F0E0FF
  FontSize 12
  ArrowColor #4A0080
  ArrowSize 1.5
}

skinparam package {
  BorderColor #006000
  BackgroundColor #DFF0D8
  Padding 10
}

skinparam cloud {
  BackgroundColor #FFF5E0
  BorderColor #FF9900
}

title Architecture Logicielle du Gring-Go

' ====================================================================
' 1. DRIVERS HÔTES & ACTIONNEURS (nRF5340 - I/O)
' ====================================================================

package "Capteurs Intelligents (Firmware Local)" as SENSOR_FIRMWARE {
  [BHI260AP (ARC FW)] as BHI_FW
  [MAX32664 (WHRM FW)] as MAX_FW
}

[STTS22H] as TEMP_S
[DRV2605L] as HAPTIC_D
[MOTOR] as HAPTIC_MOT
[INDUCTION] as INDUC

package "1. Drivers Hôtes (I²C)" as DRIVERS {
  [imu_driver.c] as IMU_DRV
  [bio_driver.c] as BIO_DRV
  [temp_driver.c] as TEMP_DRV
  [charge_driver.c] as CHARGE_DRV
  [haptic_driver.c] as HAPTIC_DRV
}

' ====================================================================
' 2. LOGIQUE SYSTÈME & ALGORITHMES LÉGERS (nRF5340 Core)
' ====================================================================

package "Zephyr SDK (Pile Système)" as Z_SDK {
  [BLE Host Stack] as BLE_HOST
}

package "2. Logique Application & Gestion" as APP_LOGIC {
  [sensors_wrapper.c] as SENS_WRAP 
  [power_monitor.c] as POWER_MONITOR
}

package "3. Services GATT (Interface BLE)" as GATT {
  [alert_service.c] as ALERT_SVC
  [health_service.c] as HEALTH_SVC 
  [battery_service.c] as BAS_C
}

package "4. Orchestration & Système" as CORE {
  [main.c] as MAIN
}

cloud "Cœur Réseau (hci_ipc)" as CPUNET
cloud "Application Mobile" as MOBILE_APP

' -------------------------------------------
' A. FLUX DE DONNÉES ET COMMANDE (Bottom-Up/Action)
' -------------------------------------------

' 1. Capteurs vers Drivers Hôtes
BHI_FW -up-> IMU_DRV : Pas, Statut
MAX_FW -up-> BIO_DRV : BPM, SpO2
TEMP_S -up-> TEMP_DRV
HAPTIC_D <-up- HAPTIC_DRV
HAPTIC_D -r-> HAPTIC_MOT
INDUC -up-> CHARGE_DRV

IMU_DRV -down-> BHI_FW : Flash
BIO_DRV -down-> MAX_FW : Flash

' 2. Aggregation et Stockage
IMU_DRV -up-> SENS_WRAP : Mouvement
BIO_DRV -up-> SENS_WRAP : Biométriques
TEMP_DRV -up-> SENS_WRAP : Température
CHARGE_DRV -up-> POWER_MONITOR : Batterie

' 3. Moniteur d'Énergie vers GATT
POWER_MONITOR -up-> BAS_C : NOTIFY (Niveau Batterie)

' 4. Haptique (Flux de commande)
ALERT_SVC -down-> HAPTIC_DRV : Déclenchement

' 5. Données vers Services GATT (Transfert Périodique/Sync)
SENS_WRAP -up-> HEALTH_SVC : NOTIFY (Synchro données)

' -------------------------------------------
' B. FLUX D'INITIALISATION & CONTRÔLE
' -------------------------------------------

' Initialisation Matérielle et Chargement FW
MAIN -down-> IMU_DRV : Flash
MAIN -down-> BIO_DRV : Flash
MAIN -down-> DRIVERS : Init

' Démarrage du BLE
MAIN -up-> BLE_HOST : Init & Publicité

' Enregistrement des services
HEALTH_SVC -up-> BLE_HOST : Enregistrement Service
ALERT_SVC -up-> BLE_HOST : Enregistrement Service
BAS_C -up-> BLE_HOST : Enregistrement Service

' -------------------------------------------
' C. PILE PROTOCOLAIRE BLE
' -------------------------------------------
BLE_HOST -up-> CPUNET : HCI
CPUNET -up-> MOBILE_APP : TX BLE

' Flux de commande haptique
MOBILE_APP -down-> CPUNET : GATT Write (Alerte)
CPUNET -down-> BLE_HOST : CMD Décodée
BLE_HOST -down-> ALERT_SVC : Callback GATT Write


@enduml